<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calculate probabilities for multiple population.
Given data on the number of 'trials' and 'succession'
in each population, calculate the
probability of success in each population.
For instance, given data on the number of respondent,
and number of employed respondents, by area,
calculate the probability of being
employed in each area. The probabilities are smoothed:
the values are shifted towards the overall mean,
with values that are based on small sample sizes being
shifted the furtherst."><title>Smooth Probabilities — smooth_prob • smoothscale</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Smooth Probabilities — smooth_prob"><meta property="og:description" content="Calculate probabilities for multiple population.
Given data on the number of 'trials' and 'succession'
in each population, calculate the
probability of success in each population.
For instance, given data on the number of respondent,
and number of employed respondents, by area,
calculate the probability of being
employed in each area. The probabilities are smoothed:
the values are shifted towards the overall mean,
with values that are based on small sample sizes being
shifted the furtherst."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">smoothscale</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/smoothscale-models.html">Statistical Models used for Smoothing and Scaling</a>
    <a class="dropdown-item" href="../articles/smoothscale-using.html">Using Package 'smoothscale'</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Smooth Probabilities</h1>
      
      <div class="d-none name"><code>smooth_prob.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate probabilities for multiple population.
Given data on the number of 'trials' and 'succession'
in each population, calculate the
probability of success in each population.
For instance, given data on the number of respondent,
and number of employed respondents, by area,
calculate the probability of being
employed in each area. The probabilities are smoothed:
the values are shifted towards the overall mean,
with values that are based on small sample sizes being
shifted the furtherst.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">smooth_prob</span><span class="op">(</span><span class="va">x</span>, <span class="va">size</span>, prior_cases <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>Number of successes in each population.
A numeric vector.</p></dd>


<dt>size</dt>
<dd><p>Number of trials in each population.
A numeric vector.</p></dd>


<dt>prior_cases</dt>
<dd><p>Parameter controlling
smoothing. Default is <code>10</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A numeric vector with the
smoothed probabilities.</p>
    </div>
    <div class="section level2">
    <h2 id="stratifying">Stratifying<a class="anchor" aria-label="anchor" href="#stratifying"></a></h2>
    


<p>It is often appropriate to stratify a population
and smooth separately within each strata.
For instance, when estimating probabilities of
being employed, it may be appropriate to divide
the population into strata defined by age and sex.</p>
<p>The easiest way to do stratified smoothing
is to use <a href="https://dplyr.tidyverse.org/reference/group_data.html" class="external-link">grouped</a>
data frames. See below for an example.</p>
    </div>
    <div class="section level2">
    <h2 id="prior-counts"><code>prior_counts</code><a class="anchor" aria-label="anchor" href="#prior-counts"></a></h2>
    


<p>The argument <code>prior_counts</code> controls the degree
of smoothing. It only has a noticeable effect
when the number of areas, and the population per
area, is small. Larger values for <code>prior_counts</code>
produce more smoothing.</p>
    </div>
    <div class="section level2">
    <h2 id="mathematical-details">Mathematical details<a class="anchor" aria-label="anchor" href="#mathematical-details"></a></h2>
    


<p>The smoothing is based on the model</p>
<p>$$x_k \sim \text{Binom}(n_k, \pi_k)$$</p>
<p>$$\pi_k \sim \text{Beta}(\lambda \nu, (1 - \lambda) \nu)$$</p>
<p>$$\lambda \sim \text{Unif}(0, 1)$$</p>
<p>$$\nu \sim \text{LogNormal}^+(\log M, 1)$$</p>
<p>where</p><ul><li><p>\(k\) indexes area or population,</p></li>
<li><p>\(x_k\) is the number of successes, which is
specified by argument <code>x</code></p></li>
<li><p>\(n_k\) is the number of trials, which is
specified by argument <code>size</code></p></li>
<li><p>\(\pi_k\) is the probability of success, and</p></li>
<li><p>\(M\) control smoothing, and can be
specified by argument <code>prior_counts</code>.</p></li>
</ul><p><code>smooth_prob()</code> returns \(\hat{\pi}_k\), the
maximum posterior density estimate of \(\pi_k\).</p>
<p>The "direct" (unsmoothed) estimate of the
probability of success is \(x_k / n_k\).</p>
<p>For details on the model, see the vignette LINK TO VIGNETTE.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## use synthetic census data</span></span></span>
<span class="r-in"><span><span class="va">census</span> <span class="op">&lt;-</span> <span class="fu">smoothscale</span><span class="fu">::</span><span class="va"><a href="syn_census.html">syn_census</a></span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## smooth all groups towards the national level</span></span></span>
<span class="r-in"><span><span class="va">smoothed</span> <span class="op">&lt;-</span> <span class="fu">smooth_prob</span><span class="op">(</span>x <span class="op">=</span> <span class="va">census</span><span class="op">$</span><span class="va">child_labour</span>,</span></span>
<span class="r-in"><span>                        size <span class="op">=</span> <span class="va">census</span><span class="op">$</span><span class="va">all_children</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">smoothed</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1] 0.3549757 0.3483956 0.2386031 0.1411431 0.2486301 0.2904461 0.2811255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [8] 0.2828551 0.1052609 0.2768318 0.1608094 0.2004207 0.2446564 0.2304158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [15] 0.2110614 0.2561533 0.1905153 0.2172556 0.2017625 0.2611232 0.2173088</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [22] 0.2145986 0.2994043 0.2539228 0.1639726 0.4176366 0.2514717 0.2754479</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [29] 0.1457469 0.2343583 0.3653098 0.2452549 0.2778678 0.1686767 0.2898178</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [36] 0.1665318 0.2057348 0.2526217 0.2426039 0.2149188 0.1887129 0.3004677</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [43] 0.2658116 0.1625439 0.1875074 0.1442691 0.2001372 0.2509286 0.2799954</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [50] 0.2273524 0.4307438 0.4802877 0.3179332 0.2053953 0.3320846 0.2904461</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [57] 0.2732541 0.3250327 0.2609691 0.3508330 0.1937606 0.2262503 0.1815952</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [64] 0.2304158 0.3077062 0.3558618 0.3045517 0.2452549 0.2362838 0.2526217</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [71] 0.2760318 0.2207024 0.2535269 0.2890901 0.2109253 0.5185639 0.4981704</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [78] 0.4011522 0.1990179 0.2697980 0.3160477 0.2811255 0.3643850 0.2644619</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [85] 0.4062783 0.2412001 0.1792203 0.3077176 0.2073400 0.2747700 0.2989522</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [92] 0.2973610 0.2930483 0.1985837 0.2526217 0.2430911 0.2759489 0.3158740</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [99] 0.3851219 0.2584483</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## compare smoothed and unsmoothed ("direct") estimates</span></span></span>
<span class="r-in"><span><span class="va">unsmoothed</span> <span class="op">&lt;-</span> <span class="va">census</span><span class="op">$</span><span class="va">child_labour</span> <span class="op">/</span> <span class="va">census</span><span class="op">$</span><span class="va">all_children</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">smoothed</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">unsmoothed</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.3549757 0.3483956 0.2386031 0.1411431 0.2486301 0.2904461</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.3602151 0.4000000 0.2371134 0.1333333 0.2450980 0.4000000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## use tidyverse functions to smooth</span></span></span>
<span class="r-in"><span><span class="co">## each age-sex group towards a</span></span></span>
<span class="r-in"><span><span class="co">## different average</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">census</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>smoothed <span class="op">=</span> <span class="fu">smooth_prob</span><span class="op">(</span>x <span class="op">=</span> <span class="va">child_labour</span>,</span></span>
<span class="r-in"><span>                                size <span class="op">=</span> <span class="va">all_children</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 100 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># Groups:   age, sex [4]</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    area    age   sex    child_labour all_children smoothed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> Area 01 5-9   Female          134          372   0.351 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> Area 02 5-9   Female           14           35   0.325 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> Area 03 5-9   Female           92          388   0.236 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> Area 04 5-9   Female           46          345   0.140 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> Area 05 5-9   Female           25          102   0.241 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> Area 06 5-9   Female            2            5   0.252 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> Area 07 5-9   Female            4           13   0.252 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> Area 08 5-9   Female           10           34   0.264 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> Area 09 5-9   Female            2           52   0.099<span style="text-decoration: underline;">5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> Area 10 5-9   Female          578         <span style="text-decoration: underline;">2</span>087   0.276 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 90 more rows</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by John Bryant, Tom Wilson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

